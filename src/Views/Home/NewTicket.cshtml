@using System.Security.Claims
@{
    ViewData["Title"] = "Chi tiết yêu cầu";
    var email = User.FindFirst(ClaimTypes.Email)?.Value
        ?? User.FindFirst("preferred_username")?.Value
        ?? User.FindFirst("upn")?.Value;
}
@* @Html.Partial("_NewTicket") *@
<h3>YÊU CẦU</h3>
<partial name="_NewTicket" />
@section Scripts {
    <script src="~/js/ajaxutil.js"></script>
    <script src="~/js/fileinput.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#btnconfirm').click(function () {
                if ($('#txtdescription').val() == '') {
                    $('#txtdescription').focus();
                    return;
                }

                var uploadCompleted = false;
                var files;

                var uploadVal = uploadFileInputs('@WebSupport.Utilities.Globals.APIUrl/Upload/Upload', '@WebSupport.Utilities.Globals.APIKey', uploadCompleted, files);
                uploadCompleted = uploadVal.uploadCompleted;
                files = uploadVal.files;

                if (uploadCompleted == false) return;

                var bodydata = {
                    email: '@email',
                    description: $('#txtdescription').val(),
                    files: files
                };
                postData('@WebSupport.Utilities.Globals.APIUrl/Tickets/Create', '@WebSupport.Utilities.Globals.APIKey', bodydata, function(response) {
                    if (response.errorCode != 0)
                    {
                        alert(response.message);
                        return;
                    }
                    window.location.href = '/Home/Index';
                });
            });
            initFileInput();
        });
    </script>
}